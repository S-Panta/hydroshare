<div class="modal fade" id="add-funding-agency" tabindex="-1" role="dialog" aria-labelledby="add-funding-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/add-metadata/" method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="add-funding-label"> Add Funding Agency</h4></div>
                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                            <div id="add-agency-app">
                                {% if resource_edit_mode %}
                                    {% csrf_token %}
                                {% endif %}
                                <div class="tags">
                                    {% if resource_edit_mode %}
                                        {% if czo_user %}
                                            <div id="add-agency-wrapper" class="input-group"
                                                    @keyup.enter="addKeyword('{{ cm.short_id }}')">
                                                {# https://github.com/alexurquhart/vue-bootstrap-typeahead #}
                                                <vue-bootstrap-typeahead
                                                        :data="{{ odm2_terms }}"
                                                        v-model="newKeyword"
                                                        {# Undocumented https://github.com/alexurquhart/vue-bootstrap-typeahead/issues/19 #}
                                                        ref="newKeyword"
                                                        input-class="typeahead-search-input"
                                                        @hit=addKeyword('{{ cm.short_id }}')
                                                        placeholder="Example: National Science Foundation">
                                                </vue-bootstrap-typeahead>
                                                <span class="input-group-btn">
                                                    <button @click="addKeyword('{{ cm.short_id }}')"
                                                            class="btn btn-success cv-add-button" type="button">Add</button>
                                                </span>
                                            </div>
                                        {% else %}
                                            <div id="cv-add-keyword-wrapper" class="input-group">
                                                <input v-model="newKeyword" id="txt-keyword" type="text" class="form-control"
                                                        ref="newKeyword"
                                                        @keyup.enter="addKeyword('{{ cm.short_id }}')"
                                                        placeholder="Examples: Hydrologic_modeling, USU, land use">
                                                <span class="input-group-btn">
                                                    <button @click="addKeyword('{{ cm.short_id }}')"
                                                            class="btn btn-success" type="button">Add</button>
                                                </span>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                    <div id="subj-inline-error" style="display:none">
                                        <p class="text-danger small" v-if="showIsDuplicate"> Duplicate. Keyword not added.</p>
                                        <div v-if="error" class='alert alert-danger has-space-top small'>
                                            <strong>Error: </strong>
                                            <span v-html="error"></span>
                                        </div>
                                    </div>
                                    <ul id="lst-tags" class="custom-well tag-list" style="display:none">
                                        <li class="small text-muted" v-if="!resKeywords.length">No subject keywords have been added.</li>
                                        <li v-else v-for="k in resKeywords">
                                            {% if resource_edit_mode %}
                                                {% if cm.raccess.published %}
                                                    <span v-if="resKeywords.length" class="tag">
                                                        ${ k }<span v-if="resKeywords.length > 1"
                                                            @click="removeKeyword('{{ cm.short_id }}', k )"
                                                            class="glyphicon glyphicon-remove-circle icon-remove"></span>
                                                    </span>
                                                {% else %}
                                                    <span v-if="resKeywords.length" class="tag">
                                                        ${ k }<span
                                                            @click="removeKeyword('{{ cm.short_id }}', k )"
                                                            class="glyphicon glyphicon-remove-circle icon-remove"></span>
                                                    </span>
                                                {% endif %}
                                            {% else %}
                                                <a class='tag' target="_blank"
                                                    :href="'/search/?subject=' + safeJS(k)">${ k }</a>
                                            {% endif %}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            {# Agency Name (Required) #}
                            <div id="div_id_agency_name" class="control-group">
                                <label for="agency_name" class="control-label requiredField">
                                    Agency Name<span class="asteriskField">*</span>
                                </label>

                                <div class="controls">
                                    <input class="form-control input-sm textInput"
                                           maxlength="250" name="agency_name" required="required" type="text">
                                </div>
                            </div>

                            {# Award Title #}
                            <div id="div_id_award_title" class="control-group">
                                <label for="award_title" class="control-label">Award Title</label>
                                <div class="controls">
                                    <input class="form-control input-sm" maxlength="250"
                                           name="award_title">
                                </div>
                            </div>

                            {# Award Number #}
                            <div id="div_id_award_number" class="control-group">
                                <label for="award_number" class="control-label">Award Number</label>
                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput" maxlength="100"
                                           name="award_number" type="text">
                                </div>
                            </div>

                            {# Agency URL #}
                            <div id="div_id_agency_url" class="control-group">
                                <label for="agency_url" class="control-label">Agency URL</label>

                                <div class="controls">
                                    <input class="form-control input-sm urlinput" maxlength="200"
                                           name="agency_url" type="url">
                                </div>
                            </div>

                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary btn-save-funding-agency btn-disable-after-valid">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_css %}
    <!-- <link href="https://unpkg.com/vue-bootstrap-typeahead/dist/VueBootstrapTypeahead.css" rel="stylesheet"> -->
    <link href="{% static 'css/vue-bootstrap-typeahead.0.2.6.css' %}" rel="stylesheet">
    <style>
        #add-agency-app {
            width: 100%;
        }

        #add-agency-app .input-group {
            width: 100%;
        }

        .vbt-autcomplete-list {
            max-height: 350px;
            overflow-y: auto;
            padding-top: 5px;
            position: absolute;
            z-index: 999
        }
    </style>
{% endblock %}

{% block extra_js %}
    <script type="text/javascript" src="{% static 'js/vue-bootstrap-typeahead.0.2.6.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/hs-vue/funding-agency-app.js' %}"></script>
{% endblock %}

