{% load static %}

{% block extra_head %}
    <link href="https://releases.transloadit.com/uppy/v4.0.5/uppy.min.css" rel="stylesheet">
{% endblock %}

{% block main %}
  <h1>Upload to {{ cm.short_id }}</h1>
  <p>Data max chunk size: {{ max_chunk_size }}</p>
  <div id="uppy"></div>
{% endblock %}

{% block extra_js %}
  <script type="module">
    import { Uppy, Dashboard, Tus } from "https://releases.transloadit.com/uppy/v4.0.5/uppy.min.mjs"

    const MAX = {{ max_chunk_size|default:5242880 }};

    new Uppy()

      .use(Dashboard, { inline: true, target: '#uppy' })
      .use(Tus, { 
        endpoint: `/hsapi/resource/${SHORT_ID}/uppy/`,
        chunkSize: MAX,

        // TODO: check quota? etc

        // limit: 0,
        // onBeforeUpload: (files) => {
        //   console.log('onBeforeUpload', files)
        //   return files
        // },
        // onBeforeSend: (request) => {
        //   console.log('onBeforeSend', request)
        //   return request
        // },
      })
  </script>
{% endblock %}