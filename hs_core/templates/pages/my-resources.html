{% extends "pages/page.html" %}
{% load pages_tags mezzanine_tags keyword_tags comment_tags hydroshare_tags %}
{% block title %}My Resources{% endblock %}

{% block main %}

<div class="container" id="main">
    <div class="row">
        <div class="col-sm-12">
            <h2 class="page-title">My Resources
                <small class="text-muted"><i>Interact with your HydroShare Content.</i></small>
            </h2>
        </div>
    </div>
    {% include "includes/resource-table.html" %}
</div>

<!-- Create Label Modal -->
<div class="modal fade" id="modalCreateLabel" tabindex="-1" role="dialog" aria-labelledby="Create New Label">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Create New Label</h4>
            </div>
            <div class="modal-body">
                <form data-id="form-create-label" action="/hsapi/_internal/label-resource-action/"
                      method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="txtLabelName">New Label Name:</label>
                        <input id="txtLabelName" name="label" type="text" class="form-control">
                        <input type="hidden" name="label_type" value="SAVEDLABEL">
                        <input type="hidden" name="action" value="CREATE">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button data-form-id="form-create-label" data-form-type="create-label" id="btn-create-label"
                        class="btn btn-primary">Create
                </button>
            </div>
        </div>
    </div>
</div>

{% block modal %}
    <!-- Manage Labels Modal -->
    <div class="modal fade" id="modalManageLabels" tabindex="-1" role="dialog" aria-labelledby="Manage Labels">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Manage Labels</h4>
                </div>
                <div class="modal-body">
                    <table id="table-user-labels" class="table">
                        <thead>
                        <tr>
                            <th>Label</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if user.ulabels.saved_labels %}
                            {% for label in user.ulabels.saved_labels %}
                                <tr>
                                    <td class="user-label" data-label="{{ label }}">{{ label }}</td>
                                    <td>
                                        <form class="hidden-form" data-id="form-delete-label-{{ label }}"
                                              action="/hsapi/_internal/label-resource-action/"
                                              method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="label" value="{{ label }}">
                                            <input type="hidden" name="label_type" value="SAVEDLABEL">
                                            <input type="hidden" name="action" value="DELETE">
                                        </form>
                                        <span data-label="{{ label }}" data-form-type="delete-label"
                                              class="btn-label-remove glyphicon glyphicon-remove"
                                              data-form-id="form-delete-label-{{ label }}"></span>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr class="no-items-found">
                                <td>No labels found.</td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Resource Modal -->
    <div class="modal fade" id="delete-multiple-resources-dialog" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="delete-resource-title">Delete Resources</h4>
                </div>
                <div class="modal-body">
                    <div id="delete-resource-messaging">Select resources to delete</div>
                    <input type="text" id="confirm-res-id-text" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="btn-delete-multiple-resources" disabled="true" class="btn btn-danger" data-dismiss="modal">Delete</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{#    To be used for querying the table in javascrip    t#}
<input id="currentUserName" value="{{ user|best_name }}" style="display:none">
<span id="csrf">{% csrf_token %}</span>

{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}">
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script type="text/javascript" charset="utf8" src="{% static 'js/jquery.dataTables.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/my-resources.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/hs_resource_table.js' %}"></script>
{% endblock %}
